name: builder

on:
  push:

jobs:
  build_testing:
    runs-on: ubuntu-22.04
    steps:
      - uses: ros-tooling/setup-ros@v0.7
        with:
          required-ros-distributions: rolling
      - uses: ros-tooling/action-ros-ci@v0.3
        with:
          package-name: drake
          target-ros2-distro: rolling
          skip-tests: true
          colcon-defaults: |
            {
              "build": {
                "cmake-target": [
                  "install"
                ],
                "cmake-args": [
                  "-DCMAKE_PREFIX_PATH=/opt/ros/rolling",
                  "-DAMENT_PREFIX_PATH=/opt/ros/rolling",
                  "-DCMAKE_INSTALL_PREFIX=/opt/ros/rolling",
                  "-DCMAKE_BUILD_TYPE=None"
                ]
              }
            }
      - name: Build cmake example
        run: |
          . /home/runner/work/ros-drake-vendor/ros-drake-vendor/ros_ws/install/setup.sh
          # Checkin if lcm-binaries are in path
          which lcm-spy || true
          git clone https://github.com/j-rivero/drake-shambhala.git
          cd drake-shambhala/drake_ament_cmake_installed/src/drake_ament_cmake_installed
          cmake -B build
          ctest --test-dir build
